<!doctype html>
<html>
  <head>
      <title>Singhal Algorithm</title>
      <script src="/js/jquery.min.js"></script>    
      <script src="/js/arrayToTable.js"></script>   
      <script src="/socket.io/socket.io.js"></script> 
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
      <meta name="description" content="">
      <meta name="author" content="">
      <!--        <link rel="icon" href="../../favicon.ico">-->
      <!-- Bootstrap core CSS -->
      <link href="/css/bootstrap.min.css" rel="stylesheet">
      <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
      <link href="/css/ie10-viewport-bug-workaround.css" rel="stylesheet">
      <!-- Custom styles for this template -->
      <link href="/css/grid.css" rel="stylesheet">
      <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
      <!--[if lt IE 9]><script src="/js/ie8-responsive-file-warning.js"></script><![endif]-->
      <script src="/js/ie-emulation-modes-warning.js"></script>
      <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
      <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
    
      <script>  
            var socket = io();   
            $('form').submit(function(){
                socket.emit('chat message', $('#m').val());
                return false;
            });

            socket.on('SystemState', function(msg){
                $('#messages').append($('<li>').text(msg));
            });
          
            socket.on('UpdateNumberOfClients', function(msg){
               UpdateNumberOfClientsWith(msg);
            });
          
            socket.on('UpdateStateMatrix', function(msg){
               
            });
          
            socket.on('GlobalStateMatrixPartial', function(msg){
                 UpdateStatePartialMatrixWith(msg);
            });
          
           socket.on('GlobalStateMatrixComplete', function(msg){
                 UpdateStateMatrixWith(msg);
            });
          
            $( document ).ready(function() {
                
                $( "#updateClients" ).click(function() {
                    socket.emit('BrowserClient', "GetTotalNumberOfClients");
                });
                
                $( "#requestStateMatrix" ).click(function() {
                    socket.emit('BrowserClient', "CreateGlobalStateMatrix");
                });

                
                $( "#jobschedule" ).click(function() {
                    var job= {};
                    job.client = $( "#jobclient" ).val();
                    job.time = $( "#jobtime" ).val();
                    job.resource = [1,2,3];
                    console.log(job);
                    socket.emit('ScheduleJob', job);
                });
            });
          
          
           function UpdateStateMatrixWith(data){
           
               if(data.length>0){
                   var sz =data[0].length;
                   var tableHeader = ["Site #"];
                   for(var k =0;k<sz-1;k++){
                       tableHeader.push(k+1);
                   }
               
                   var finalData = [];
                   finalData.push(tableHeader);
                   
                   for (var i =0; i<data.length; i++){
                       finalData.push(data[i]);
                   }
                   $("#SateMatrix" ).html(arrayToTable(finalData));
                   
               }
          }
          
          function UpdateStatePartialMatrixWith(data){
               //console.log(data);
               $( "#SateMatrix" ).html(data);
          }
          
          function UpdateNumberOfClientsWith(data){
              console.log(data);
              $( "#numberOfClients" ).html("Number of Clients: " + data);
          }
          
          function ScheduleJobAt(){
              
          }

      </script>
  </head>
    <body>
        
        <div class="container">

          <div class="page-header">
            <h1>Singhal Algorithm</h1>
            <p class="lead">Distributed Mutual Exclusion Algorithm</p>
          </div>


            <div id="stateMatrix" >

            </div>
            
            <div id="updateClients" class="row">

                <div class=".col-xs-8"> 
                     <div id="numberOfClients" >
                        <p>Number of Clients: UKNOWN!</p>
                    </div>
                    <button class="btn btn-default btn-sm" >
                      <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span>
                    </button>
                </div>

            </div>
        
            <hr>
        
            <h3>Schedule Job</h3>
                <p >Schedule Job on Clients</p> 
            
            
            <table class="table table-hover"> 
                <thead> <tr> <th>#</th> <th>Client ID</th> <th>Job Duration</th> <th>Resourcers</th> <th></th>  </tr> </thead>
                <tbody>
                    <tr> 
                        <th scope="row">1</th> 
                        <td>     <input id="jobclient" value="1" />   </td> <td> <input  id="jobtime" value="5" /> </td> 
                        <td> <input id="resources" value="1" /> </td>
                    <td> <button id="jobschedule" class="btn btn-default" >Schedule Job</button> </td> </tr> <tr>  
                    </tr> 
                </tbody> 
            </table>
        
        <hr>
        
        <div id="requestStateMatrix">
            <button class="btn btn-default">Request State Matrix</button>
        </div>
        <br>
        <div id="SateMatrix">
             
        </div>
            
            
            
            

    </div> <!-- /container -->
        
        
        
        
        <script src="/js/ie10-viewport-bug-workaround.js"></script>
    </body>
</html>